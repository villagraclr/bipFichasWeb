function queryString(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");a=new RegExp("[\\?&]"+a+"=([^&#]*)").exec(window.location.href);return null==a?"":a[1]}function ocultaMenu(){$("#side-menu li").each(function(a,o){"liMenuGeneral"!=o.id&&$(o).is(":visible")?$(o).css("display","none"):$(o).css("display","block")})}function agregaMenuPrincipal(){var r,a={url:ROOT+"Content/ArchivosSubidos/formulario_"+tipoPrograma+".json",contentType:"application/json",datatype:"json",async:!1,beforeSend:function(){$("#cargaPagina").fadeIn()},success:function(a,o,e){const n=[765,796,873,901,936,938,979];r=-1!==$.inArray(rol,[1,2,5,6])?a.menu:$.grep(a.menu,function(a,o){return 737!=a.menuPadre.IdMenu&&-1==$.inArray(a.menuPadre.IdMenu,n)&&776!=a.menuPadre.IdMenu});var t='<ul id="aMenuForm" class="nav nav-pills nav-stacked">';$.each(r,function(a,e){var o=0<comentarios.length?$.grep(comentarios,function(a,o){return a.IdMenu===e.menuPadre.IdMenu}):null,o=null!=o&&0<o.length?o.length:"";-1!==$.inArray(e.menuPadre.IdMenu,n)&&329!=etapa&&349!=etapa||(t+='<li role="presentation" id="'+e.menuPadre.IdMenu+'"'+(tab==e.menuPadre.IdMenu||0==tab&&1==e.menuPadre.Orden?"class=active":"")+'><a href="#tabForm'+e.menuPadre.Orden+'" data-toggle="pill" onclick="validaBlancos(false, '+e.menuPadre.IdMenu+', 0);">'+e.menuPadre.TipoMenu+'<span id="spnPadre'+e.menuPadre.IdMenu+'" class="badge" style="display: inline; padding: 0px 7px; margin-left: 10px; background-color: #8400CA;"></span><span id="spnPadreTotalComent'+e.menuPadre.IdMenu+'" class="badge">'+o+"</span></a></li>")}),$(".sidebar-nav").append('<ul id="aMenuForm" class="nav nav-pills nav-stacked">'+t+"</ul>")},error:function(a,o,e){$("#txtMensajesFormulario").empty(),$("#txtMensajesFormulario").html("<p>"+e+"</p>"),$("#modalMensajesFormularios").modal("show"),console.log(e)},complete:function(){$("#cargaPagina").fadeOut()}};return $.ajax(a),r}function buscaExcepciones(){var n,a={url:ROOT+"Formulario/BuscaExcepciones",data:{_id:queryString("_id")},type:"post",datatype:"json",async:!1,beforeSend:function(){$("#cargaPagina").fadeIn()},success:function(a,o,e){n=JSON.parse(a)},error:function(a,o,e){$("#txtMensajesFormulario").empty(),$("#txtMensajesFormulario").html("<p>"+e+"</p>"),$("#modalMensajesFormularios").modal("show"),console.log(e)},complete:function(){$("#cargaPagina").fadeOut()}};return $.ajax(a),n}async function funciones(n){var a={url:ROOT+"Content/ArchivosSubidos/funciones_"+tipoPrograma+".json",contentType:"application/json",datatype:"json",beforeSend:function(){$("#cargaPagina").fadeIn()},success:function(a,o,e){(async()=>{await funcionesFormularios(a,n)})()},error:function(a,o,e){$("#txtMensajesFormulario").empty(),$("#txtMensajesFormulario").html("<p>"+e+"</p>"),$("#modalMensajesFormularios").modal("show"),console.log(e)},complete:function(){validaBlancos(!0,0,0),$("#cargaPagina").fadeOut()}};$.ajax(a)}function modalComentarios(a){$("#txtTemaComentario").val(""),$("#cmbOpcObservaciones option[value='-1']").prop("selected",!0),$("#txtComentarios").val(""),$("#menuId").val(a),$("#modalComentarios").resizable({minHeight:300,minWidth:300}),$("#modalComentarios").draggable({handle:".modal-header"}),$("#modalComentarios").modal("show")}function abreInformes(a,o,e){var n=$("#cmbVersionInforEval option:selected").val();"-1"!=n?window.open(a.replace("{0}",n).replace("{1}",o)):($("#txtMensajesFormulario").empty(),$("#txtMensajesFormulario").html("<p>Seleccione al menos una versión del informe</p>"),$("#modalMensajesFormularios").modal("show"))}function ingresarComentarios(o,a,e,n){txtComentariosInstancia.setData(""),$("#idConsulta").val(""),$("#idPregunta").val(o),$("#idTab").val(a),$("#idMenuPadre").val(e),$("#idMenuHijo").val(n),$("#modalComentarios").resizable({minHeight:300,minWidth:300}),$("#modalComentarios").draggable({handle:".modal-header"});var t,a={url:ROOT+"Formulario/GetComentarios",data:{_id:queryString("_id")},type:"post",datatype:"json",async:!1,beforeSend:function(){$("#cargaPagina").fadeIn()},success:function(a,o,e){comentarios=JSON.parse(a)},error:function(a,o,e){$("#txtMensajesFormulario").empty(),$("#txtMensajesFormulario").html("<p>"+e+"</p>"),$("#modalMensajesFormularios").modal("show"),console.log(e)},complete:function(){$("#cargaPagina").fadeOut()}};$.ajax(a),0<comentarios.length&&($("#ulComentarios").empty(),0<(t=$.grep(comentarios,function(a){return a.IdPregunta===o})).length)&&($("#msjAlert"+t[0].IdPregunta+t[0].IdTab).remove(),$("#btnIngresarComent"+t[0].IdPregunta).removeClass("btn-warning").addClass("btn-success"),$("#ibtnComent"+t[0].IdPregunta).removeClass("fa-bell-o").addClass("fa-comment"),$.each(t,function(a,o){var e=(a+1)%2!=0?"left":"right",n=o.IdUsuario==usuario&&t.length==a+1?'<button id="btnEditaComentario" type="button" class="btn btn-success btn-xs" data-toggle="tooltip" data-placement="top" title="Editar comentario" style="margin-right: 2px; margin-left: 5px;" onclick="editaComentario('+o.IdConsulta+",'"+o.Consulta+'\');"><i class="fa fa-pencil-square-o" aria-hidden="true"></i></button><button id="btnEliminaComentario" type="button" class="btn btn-danger btn-xs" data-toggle="tooltip" data-placement="top" title="Eliminar comentario" style="margin-right: 5px;" onclick="eliminaComentario('+o.IdConsulta+","+o.IdPrograma+","+o.IdMenu+","+o.IdMenuHijo+","+o.IdPregunta+",'"+o.IdUsuario+'\');"><i class="fa fa-trash" aria-hidden="true"></i></button>':"",a=(a+1)%2!=0?'<strong class="primary-font">'+o.NombreUsuario+'</strong><small class="pull-right text-muted">'+("left"==e?n:"")+'<span class="glyphicon glyphicon-time"></span>'+moment(o.Fecha).format("DD/MM/YYYY HH:mm:ss")+"</small>":'<small class="text-muted"><span class="glyphicon glyphicon-time"></span>'+moment(o.Fecha).format("DD/MM/YYYY HH:mm:ss")+"</small>"+("left"==e?"":n)+'<strong class="pull-right primary-font">'+o.NombreUsuario+"</strong>";$("#ulComentarios").append('<li class="'+e+' clearfix" style="margin-right: 10px;"><span class="chat-img pull-'+e+'"><h2 style="margin-top: 0px !important; margin-bottom: 0px !important; color: '+("left"==e?"#337ab7":"#d9534f")+' !important;">'+o.NombreUsuario.split(" ")[0].substring(0,1).toUpperCase()+o.NombreUsuario.split(" ")[1].substring(0,1).toUpperCase()+'</h2></span><div class="chat-body clearfix"><div class="header" style="margin-bottom: 5px">'+a+'</div><p id="comentario'+o.IdConsulta+'">'+o.Consulta+"</p></div></li>")})),$("#divTextoComentarios").css("display","none"),$("#btnIngComent").css("display","none"),$("#btnNuevoComent").css("display",""),$("[data-toggle=tooltip]").tooltip({html:!0}),$("#modalComentarios").modal("show")}function editaComentario(a,o){$("#btnEditaComentario").prop("disabled",!0),txtComentariosInstancia.setData(o),$("#divTextoComentarios").css("display",""),$("#btnIngComent").css("display",""),$("#btnNuevoComent").css("display","none"),$("#idConsulta").val(a)}function eliminaComentario(a,o,e,n,t,r){modalMsjConfirm("Eliminar comentario","<p>¿Está seguro que desea eliminar este comentario?</p>",o,r,a,e,n,t)}function modalMsjConfirm(a,o,e,n,t,r,s,i){$("#tituloMsjConfirm").empty(),$("#tituloMsjConfirm").text(a),$("#bodyMsjConfirm").html(o),$("#borraIdConsulta").val(t),$("#borraIdPrograma").val(e),$("#borraIdMenuPadre").val(r),$("#borraIdMenuHijo").val(s),$("#borraIdPregunta").val(i),$("#borraIdUsuario").val(n),$("#modalMsjConfirm").modal("show")}$(document).ready(function(){btnEnviarEval=0,btnEnviarObs=0,ocultaMenu(),$("#aMenuGeneral").removeAttr("href").css("cursor","pointer"),$("#aMenuGeneral").click(ocultaMenu);var a=agregaMenuPrincipal(),o=buscaExcepciones();creaFormulario(a,respuestas,o),(async()=>{await funciones(respuestas)})(),$("#guardar").click(function(){$(this).button("loading"),$("#cargaPagina").fadeIn();var a=$("#formularios").find(":input:disabled").removeAttr("disabled"),o=new FormData,n=[],e=($.each($("form").serializeArray({checkboxesAsBools:!0}),function(a,o){var e={};e.idPregunta=o.name.split("_")[0],e.idTab=o.name.split("_")[1],e.respuesta=o.value,n.push(e)}),JSON.stringify(n)),e=(o.append("id",queryString("_id")),o.append("data",e),a.attr("disabled","disabled"),{url:ROOT+"Formulario/GuardaDatos",data:o,type:"post",contentType:!1,processData:!1,success:function(a,o,e){$("#guardar").button("reset"),"ok"==a?(validaBlancos(!1,0,0),$("#txtMensajesFormulario").empty(),$("#txtMensajesFormulario").html("<p>Guardado exitoso</p>"),$("#modalMensajesFormularios").modal("show")):($("#txtMensajesFormulario").empty(),$("#txtMensajesFormulario").html("<p>"+a+"</p>"),$("#modalMensajesFormularios").modal("show"),console.log(a))},error:function(a,o,e){$("#txtMensajesFormulario").empty(),$("#txtMensajesFormulario").html("<p>"+e+"</p>"),$("#modalMensajesFormularios").modal("show"),console.log(e)},complete:function(){$("#cargaPagina").fadeOut()}});$.ajax(e)}),$("#btnEnviarEvaluar").click(function(){$("#modalFinRevision").modal("show")}),$('input[name="cbkMarcaTodos"]').click(function(){$(this).is(":checked")?$(".cbkTodos"+$(this).val()).prop("checked",!0):$(".cbkTodos"+$(this).val()).prop("checked",!1)}),$("#btnFinRevAcep").click(function(){var e,n,a=1;if($("#iterar:radio").is(":checked")&&(e=0,$.each($('input[name = "cbkPregIterar"]'),function(a,o){o.checked&&(e=1)}),e||(a=0,$("#txtMensajesFormulario").empty(),$("#txtMensajesFormulario").html("<p>Seleccione al menos una pregunta a iterar</p>"),$("#modalMensajesFormularios").modal("show"))),$("#evaluar:radio").is(":checked")){for(var o=1,t=0;t<=$("#cmb6834 option:selected").val();t++)"-1"==$("#Tabcmb9675"+t.toString()+" option:selected").val()&&(o=0);for(t=0;t<=$("#cmb3036 option:selected").val();t++)"-1"==$("#Tabcmb9676"+t.toString()+" option:selected").val()&&(o=0);o||(a=0,$("#txtMensajesFormulario").empty(),$("#txtMensajesFormulario").html("<p>Recuerde que debe seleccionar si sus indicadores de propósito y complementarios son comparables o no.</p>"),$("#modalMensajesFormularios").modal("show"))}a&&($(this).button("loading"),n=[],$.each($('input[name = "cbkPregIterar"]'),function(a,o){o.checked&&n.push(o.value)}),a=$("#iterar:radio").is(":checked")?1:2,a={url:ROOT+"Formulario/IterarEvaluar",data:{_id:queryString("_id"),pregIterar:n,opcion:a,tipoPrograma:tipoPrograma},type:"post",datatype:"json",async:!1,beforeSend:function(){$("#cargaPagina").fadeIn()},success:function(a,o,e){$("#btnFinRevAcep").button("reset"),"ok"==a?window.location.href=ROOT+"Programa/Programas":($("#txtMensajesFormulario").empty(),$("#txtMensajesFormulario").html("<p>"+a+"</p>"),$("#modalMensajesFormularios").modal("show"),console.log(a))},error:function(a,o,e){$("#txtMensajesFormulario").empty(),$("#txtMensajesFormulario").html("<p>"+e+"</p>"),$("#modalMensajesFormularios").modal("show"),console.log(e)},complete:function(){$("#cargaPagina").fadeOut()}},$.ajax(a))}),$("#btnEnviar").click(function(){$("#modalMensajesEnviar").modal("show")}),$("#btnMsjEnviarAcep").click(function(){$(this).button("loading");var a={url:ROOT+"Formulario/revisionAnalista",data:{_id:queryString("_id")},type:"post",datatype:"json",async:!1,beforeSend:function(){$("#cargaPagina").fadeIn()},success:function(a,o,e){a?window.location.reload():($("#txtMensajesFormulario").empty(),$("#txtMensajesFormulario").html("<p>"+a+"</p>"),$("#modalMensajesFormularios").modal("show"),console.log(a))},error:function(a,o,e){$("#txtMensajesFormulario").empty(),$("#txtMensajesFormulario").html("<p>"+e+"</p>"),$("#modalMensajesFormularios").modal("show"),console.log(e)}};$.ajax(a)}),$("#btnNuevoComent").click(function(){$("#divTextoComentarios").css("display",""),$("#btnIngComent").css("display",""),$(this).css("display","none")}),$("#btnIngComent").click(function(){$(this).button("loading");var a=txtComentariosInstancia.getData(),o=$("#idMenuPadre").val(),e=$("#idMenuHijo").val(),n=$("#idPregunta").val(),t=$("#idTab").val(),r=$("#idConsulta").val(),o={url:ROOT+"Formulario/ingresaComentario",data:{_id:queryString("_id"),idMenuP:o,idMenuH:e,idPreg:n,idT:t,idConsulta:r,comentario:a},type:"post",datatype:"json",async:!1,beforeSend:function(){$("#cargaPagina").fadeIn()},success:function(a,o,e){$("#btnIngComent").button("reset"),$("#modalComentarios").modal("hide"),0<a.IdPrograma?($("#txtMensajesFormulario").empty(),$("#txtMensajesFormulario").html("<p>Comentario creado exitosamente</p>"),$("#modalMensajesFormularios").modal("show"),comentarioschat.server.comentariosChat(a)):($("#txtMensajesFormulario").empty(),$("#txtMensajesFormulario").html("<p>Error al ingresar comentarios</p>"),$("#modalMensajesFormularios").modal("show"))},error:function(a,o,e){$("#txtMensajesFormulario").empty(),$("#txtMensajesFormulario").html("<p>"+e+"</p>"),$("#modalMensajesFormularios").modal("show"),console.log(e)},complete:function(){$("#cargaPagina").fadeOut()}};$.ajax(o)}),$("#btnSalir").click(function(){tipoAcceso==accesoFormGuardado?$("#modalMensajesSalir").modal("show"):window.location.href=ROOT+"Programa/Programas"}),$("#btnMensjAceptar").click(function(){$(this).button("loading");var a={url:ROOT+"Formulario/SalirPrograma",data:{_id:queryString("_id")},type:"post",datatype:"json",async:!1,beforeSend:function(){$("#cargaPagina").fadeIn()},success:function(a,o,e){$("#btnMensjAceptar").button("reset"),window.location.href=ROOT+"Programa/Programas"},error:function(a,o,e){$("#txtMensajesFormulario").empty(),$("#txtMensajesFormulario").html("<p>"+e+"</p>"),$("#modalMensajesFormularios").modal("show"),console.log(e)},complete:function(){$("#cargaPagina").fadeOut()}};$.ajax(a)}),$("#txtRespuestas").keyup(function(){var a=1500-$(this).val().length<0?0:1500-$(this).val().length;$("#caractRespuestas").text("Caracteres restantes="+a)}),$("#btnDescargaInforme").click(function(){$("#modalDescargaInformes").modal("show")}),$("#btnEnvioEvaluacion").click(function(){$("#modalEnvioEvaluacion").modal("show")}),$("#btnEnvioSect").click(function(){$(this).button("loading");var a={url:ROOT+"Formulario/EnvioEvaluacion",data:{_id:queryString("_id"),tipo:2},type:"post",datatype:"json",async:!1,beforeSend:function(){$("#cargaPagina").fadeIn()},success:function(a,o,e){$("#btnEnvioSect").button("reset"),$("#modalEnvioEvaluacion").modal("hide"),"ok"==a?($("#txtMensajesFormulario").empty(),$("#txtMensajesFormulario").html("<p>Evaluación enviada exitosamente</p>")):($("#txtMensajesFormulario").empty(),$("#txtMensajesFormulario").html("<p>"+a+"</p>")),$("#modalMensajesFormularios").modal("show")},error:function(a,o,e){$("#txtMensajesFormulario").empty(),$("#txtMensajesFormulario").html("<p>"+e+"</p>"),$("#modalMensajesFormularios").modal("show"),console.log(e)},complete:function(){$("#cargaPagina").fadeOut()}};$.ajax(a)}),$("#btnEnvioJef").click(function(){$(this).button("loading");var a={url:ROOT+"Formulario/EnvioEvaluacion",data:{_id:queryString("_id"),tipo:1},type:"post",datatype:"json",async:!1,beforeSend:function(){$("#cargaPagina").fadeIn()},success:function(a,o,e){$("#btnEnvioJef").button("reset"),$("#modalEnvioEvaluacion").modal("hide"),"ok"==a?($("#txtMensajesFormulario").empty(),$("#txtMensajesFormulario").html("<p>Evaluación enviada exitosamente</p>"),$("#modalMensajesFormularios").modal("show"),window.location.reload()):($("#txtMensajesFormulario").empty(),$("#txtMensajesFormulario").html("<p>"+a+"</p>"),$("#modalMensajesFormularios").modal("show"))},error:function(a,o,e){$("#txtMensajesFormulario").empty(),$("#txtMensajesFormulario").html("<p>"+e+"</p>"),$("#modalMensajesFormularios").modal("show"),console.log(e)},complete:function(){$("#cargaPagina").fadeOut()}};$.ajax(a)}),$("#btnMsjConfirm").click(function(){$(this).button("loading");var a={url:ROOT+"Formulario/BorrarComentario",data:{idConsulta:$("#borraIdConsulta").val()},type:"post",datatype:"json",async:!1,beforeSend:function(){$("#cargaPagina").fadeIn()},success:function(a,o,e){$("#btnMsjConfirm").button("reset"),$("#modalMsjConfirm").modal("hide"),"ok"==a?($("#txtMensajesFormulario").empty(),$("#txtMensajesFormulario").html("<p>Comentario eliminado exitosamente</p>"),$("#modalMensajesFormularios").modal("show"),comentarioschat.server.borraComentariosChat($("#borraIdPrograma").val(),$("#borraIdUsuario").val(),$("#borraIdMenuHijo").val(),$("#borraIdMenuPadre").val(),$("#borraIdPregunta").val())):($("#txtMensajesFormulario").empty(),$("#txtMensajesFormulario").html("<p>"+a+"</p>"),$("#modalMensajesFormularios").modal("show"))},error:function(a,o,e){$("#txtMensajesFormulario").empty(),$("#txtMensajesFormulario").html("<p>"+e+"</p>"),$("#modalMensajesFormularios").modal("show"),console.log(e)},complete:function(){$("#cargaPagina").fadeOut()}};$.ajax(a)})});