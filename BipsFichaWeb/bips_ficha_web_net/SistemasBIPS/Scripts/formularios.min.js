function validaArchivo(a) { if ("pdf" != a.value.split(".").pop()) return $("#txtMensajesFormulario").empty(), $("#txtMensajesFormulario").html("<p>El tipo de archivo seleccionado no es válido</p>"), $("#modalMensajesFormularios").modal("show"), !1 } function queryString(a) { a = a.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]"); var e = new RegExp("[\\?&]" + a + "=([^&#]*)").exec(window.location.href); return null == e ? "" : e[1] } function soloNumeros(a, e) { for (var n in key = a.keyCode || a.which, tecla = String.fromCharCode(key).toLowerCase(), letrasEspeciales = 1 == e ? "," : "", letras = "0123456789-" + letrasEspeciales, especiales = [8, 37, 39, 9], tecla_especial = !1, especiales) if (key == especiales[n]) { tecla_especial = !0; break } if (-1 == letras.indexOf(tecla) && !tecla_especial) return !1 } function retornaValorFormateado(a) { var e; return e = "" == a ? 0 : quitaPuntos(a).replace(",", "."), parseFloat(e) } function quitaPuntos(a) { for (var e = a + "", n = 0; n < e.length && (e.indexOf(".") > 0 && (e = e.replace(".", "")), e.length != n - 1) ; n++); return e } function ocultaMenu() { $("#side-menu li").each(function (a, e) { "liMenuGeneral" != e.id && $(e).is(":visible") ? $(e).css("display", "none") : $(e).css("display", "block") }) } function ocultaTabs(a, e, n) { var t = $("#ul" + a + " li"); for (t.removeClass("active"), t.css("display", "block"), i = e; i < t.length; i++) t[i].style.display = "none"; n ? $("#ul" + a + " li:eq(0) a").trigger("click") : $("#ul" + a + " li:eq(" + parseInt(e - 1) + ") a").trigger("click") } function validaDatos(a) { var e = 0; return $("." + a).each(function (a, n) { if ("" == $.trim($(this).val())) return e = 1, !1 }), e } $("#formularios").submit(function (a) { var e = $("<input>").attr("type", "hidden").attr("name", "_id").val(queryString("_id")), n = $("#aMenuForm li.active").attr("id"), t = $("<input>").attr("type", "hidden").attr("name", "_tab").val(n), i = $("<input>").attr("type", "hidden").attr("name", "_tabForm").val($("#ulForm" + n + " li.active").attr("id")); if ($("#formularios").append($(e)), $("#formularios").append($(t)), $("#formularios").append($(i)), 1 == btnEnviarEval) { var o = $("<input>").attr("type", "hidden").attr("name", "_enviar").val(btnEnviarEval); $("#formularios").append($(o)) } if (1 == btnEnviarObs || 2 == btnEnviarObs || 3 == btnEnviarObs || 4 == btnEnviarObs || 5 == btnEnviarObs) { var r = $("<input>").attr("type", "hidden").attr("name", "_enviarObs").val(btnEnviarObs); $("#formularios").append($(r)) } $("#cargaPagina").fadeIn() }), $("#salirForm").submit(function (a) { var e = $("<input>").attr("type", "hidden").attr("name", "_idSalida").val(queryString("_id")); $("#salirForm").append($(e)) }), $("#guardar").click(function () { $(this).button("loading"), btnEnviarEval = 0, btnEnviarObs = 0, $("#formularios").submit() }), $("#btnMensjAceptar").click(function () { $("#salirForm").submit() }), $("#btnSalir").click(function () { var a = $("<input>").attr("type", "hidden").attr("name", "_idSalida").val(queryString("_id")); $("#salirForm").append($(a)), tipoAcceso == accesoFormGuardado ? $("#modalMensajesSalir").modal("show") : $("#salirForm").submit() }), $("#btnEnviar").click(function () { tipoAcceso == accesoFormGuardado && $("#modalMensajesEnviar").modal("show") }), $("#btnMsjEnviarAcep").click(function () { $("#btnEnviar").button("loading"), btnEnviarEval = 1, $("#formularios").submit() }), $(document).ready(function () { btnEnviarEval = 0, btnEnviarObs = 0, ocultaMenu(), $("#aMenuGeneral").removeAttr("href").css("cursor", "pointer"), $("#aMenuGeneral").click(ocultaMenu), ocultaTabs(); var a = '<ul id="aMenuForm" class="nav nav-pills nav-stacked">'; $.each(menuPadres, function (e, n) { a += '<li role="presentation" id="' + n.IdMenu + '"' + (tab == n.IdMenu || 0 == tab && 1 == n.Orden ? "class=active" : "") + '><a href="#tabForm' + n.Orden + '" data-toggle="pill">' + n.TipoMenu + "</a></li>" }), $(".sidebar-nav").append('<ul id="aMenuForm" class="nav nav-pills nav-stacked">' + a + "</ul>"), $("#btnFinalizarRevision").click(function () { $("#modalMensajeFinalizarRevision").modal("show") }), $("#btnMsjGuardParcial").click(function () { $(this).button("loading"), btnEnviarObs = 3, $("#formularios").submit() }), $("#btnMsjFinalizarRev").click(function () { $("#modalMensajeFinalizarRevision").modal("hide"), $("#cmbOpcObservaciones option[value='-1']").prop("selected", !0), $("#modalFinRevision").modal("show") }), $("#btnFinRevAcep").click(function () { "-1" != $("#cmbOpcObservaciones").val() ? "1" == $("#cmbOpcObservaciones").val() ? ($("#btnFinRevAcep").button("loading"), btnEnviarObs = 1, $("#formularios").submit()) : "2" == $("#cmbOpcObservaciones").val() ? ($("#btnFinRevAcep").button("loading"), btnEnviarObs = 2, $("#formularios").submit()) : "3" == $("#cmbOpcObservaciones").val() && ($("#btnFinRevAcep").button("loading"), btnEnviarObs = 4, $("#formularios").submit()) : ($("#txtMensajesFormulario").empty(), $("#txtMensajesFormulario").html("<p>Seleccione una opción</p>"), $("#modalMensajesFormularios").modal("show")) }), $("#btnEnviarEvaluar").click(function () { $("#modalMensajesEvaluar").modal("show") }), $("#btnMsjEvalAcep").click(function () { $(this).button("loading"), $("#cargaPagina").fadeIn(); var a = { url: ROOT + "Formulario/EtapaEvaluacion", data: { _id: queryString("_id") }, type: "post", datatype: "json", success: function (a, e, n) { "ok" == a ? location.reload() : ($("#txtMensajesFormulario").empty(), $("#txtMensajesFormulario").html("<p>" + a + "</p>"), $("#modalMensajesFormularios").modal("show"), console.log(a)) }, error: function (a, e, n) { $("#txtMensajesFormulario").empty(), $("#txtMensajesFormulario").html("<p>" + n + "</p>"), $("#modalMensajesFormularios").modal("show"), console.log(n) } }; $.ajax(a) }), preguntasEval.length > 0 && $.each(preguntasEval, function (a, e) { e.IdParametro != e.idCategoria && $("#" + e.IdPreguntaDesc).prop("readonly", !1).prop("disabled", !1) }), $("#btnGuardarEvaluacion").click(function () { $(this).button("loading"); var a = queryString("_id"), e = []; if (preguntasEval.length > 0) { $.each(preguntasEval, function (a, n) { n.IdParametro != n.idCategoria && (dato = {}, dato.IdPregunta = n.IdPregunta, dato.IdTab = n.IdTab, "cmb" == n.IdPreguntaDesc.substring(3, 6) ? dato.Respuesta = $("#" + n.IdPreguntaDesc + " option:selected").val() : "cbx" == n.IdPreguntaDesc.substring(3, 6) ? dato.Respuesta = $("#" + n.IdPreguntaDesc).is(":checked") ? "on" : "" : dato.Respuesta = $("#" + n.IdPreguntaDesc).val(), e.push(dato)) }); var n = { url: ROOT + "Formulario/GuardaEvaluacion", data: { id: a, data: e }, type: "post", datatype: "json", success: function (a, e, n) { $("#btnGuardarEvaluacion").button("reset"), "ok" == a ? ($("#txtMensajesFormulario").empty(), $("#txtMensajesFormulario").html("<p>Guardado exitoso</p>"), $("#modalMensajesFormularios").modal("show")) : ($("#txtMensajesFormulario").empty(), $("#txtMensajesFormulario").html("<p>" + a + "</p>"), $("#modalMensajesFormularios").modal("show"), console.log(a)) }, error: function (a, e, n) { $("#txtMensajesFormulario").empty(), $("#txtMensajesFormulario").html("<p>" + n + "</p>"), $("#modalMensajesFormularios").modal("show"), console.log(n) } }; $.ajax(n) } }) });