@using SistemasBIPS.Models
@model GoresViewModels
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@{
    ViewBag.Title = "Ministerio de Desarrollo Social y Familia - Gobierno de Chile";
}
@section styles {
    @Styles.Render("~/Content/Fonts_min")
    @Styles.Render("~/Content/DataTable")
    @Styles.Render("~/Content/HomeFormularios")
}
<div id="page-wrapper">
    <div class="row">
        <ol class="breadcrumb breadcrumbBIPS">
            <li><a><i class="fa fa-bars fa-fw"></i> Gores</a></li>
            <li class="active"><i class="fa fa-edit fa-fw"></i> Programas</li>
        </ol>
    </div>
    <div class="row">
        <!--Filtros-->
        <div class="col-lg-12 anti-padding-RL">
            <div class="panel panel-info paneles-info">
                <div class="panel-heading paneles-heading">
                    <h4 class="panel-title">
                        <a data-toggle="collapse" href="#acordfiltros">Filtros</a> <span class="caret"></span>
                    </h4>
                </div>
                <div class="panel-collapse collapse" id="acordfiltros">
                    <div class="panel-body paneles-body paneles-font">
                        <ul class="nav nav-tabs">
                            <li class="active"><a href="#fAnos" data-toggle="tab">Años</a></li>
                            <li><a href="#fMinisServ" data-toggle="tab">Gobiernos Regionales</a></li>
                        </ul>
                        <div class="tab-content">
                            <!--Filtros años-->
                            <div class="tab-pane fade active in" id="fAnos">
                                <div class="panel-body paneles-body">
                                    <div class="col-xs-6 col-md-4 padding-left-filtros" style="margin-top: 10px;">
                                        <ul class="list-group margen-lista">
                                            <li class="list-group-item padding-filtros">
                                                <div class="checkbox margen-checkbox">
                                                    <label><input type="checkbox" name="anosFiltro" value="0" id="todosAnosFiltro" />Todos</label>
                                                </div>
                                            </li>
                                            @{ int anoInicial = 0; }
                                            @foreach (var ano in Model.listaAnos)
                                            {
                                                <li class="list-group-item padding-filtros">
                                                    <div class="checkbox margen-checkbox">
                                                        <label><input type="checkbox" value="@ano" name="anosFiltro" class="anosFiltro" @(ano > anoInicial ? "checked" : string.Empty) />@ano</label>
                                                    </div>
                                                </li>
                                                anoInicial = ano;
                                            }
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <!--Filtros gores-->
                            <div class="tab-pane fade" id="fMinisServ">
                                <div class="panel-body paneles-body">
                                    <div class="col-xs-6 col-md-4 padding-left-filtros" style="margin-top: 10px;">
                                        <ul class="list-group margen-lista">
                                            <li class="list-group-item padding-filtros">
                                                <div class="checkbox margen-checkbox">
                                                    <label><input type="checkbox" name="goresFiltro" value="0" id="todosGoresFiltro" checked />Todos</label>
                                                </div>
                                            </li>
                                            @foreach (var gore in Model.listaGores)
                                            {
                                                <li class="list-group-item padding-filtros">
                                                    <div class="checkbox margen-checkbox">
                                                        <label><input type="checkbox" value="@gore.IdParametro" name="goresFiltro" class="anosFiltro" />@gore.Descripcion</label>
                                                    </div>
                                                </li>
                                            }
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!--Tabla Formularios-->
        <div class="col-lg-12" style="padding-left:0px;padding-right:0px">
            <div class="table-responsive">
                <table class="table table-striped table-bordered table-hover" cellspacing="0" id="tblProgramas">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Año</th>
                            <th>Gobierno Regional</th>
                            <th>Tipo</th>
                            <th>Nombre</th>
                            <th>Etapa</th>
                            <th>Ficha</th>
                            <th>Liberar</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>        
    </div>
</div>
<!--Modal mensajes-->
<div id="modalMensajesFormularios" class="modal fade" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">Información</h4>
            </div>
            <div class="modal-body" id="txtMensajesFormulario"></div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-dismiss="modal">Aceptar</button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
@section scripts {
    @Scripts.Render("~/bundles/DataTable")
    <script src="~/Scripts/jquery.signalR-2.4.2.min.js"></script>
    <script src="~/signalr/hubs"></script>
    <script type="text/javascript">
        var ROOT = "@Url.Content("~/")";
        window.MyApp  = {};
        MyApp.rootPath = '@Url.Content("~")';
        var permisoLibera = "@Model.permisoLibera";
        var arrayFT = [];
        @if (Model.listaFormulariosTomados.Count > 0){
            //int acceso = 0;
            foreach (var item in Model.listaFormulariosTomados){
                <text>arrayFT.push(@item.IdFormulario);</text>
            }
        }
        var tiposProgramas = [];
        @if (Model.listaTiposProgramas.Count > 0){
            foreach(var tipo in Model.listaTiposProgramas)
            {
                <text>
                var m = {};
                m.Id = @(Model.listaRutasFichas.Count > 0 ? (Model.listaRutasFichas.Count(p=>p.Valor == tipo.Valor) > 0 ? tipo.IdParametro : 0) : 0);
                m.IdPadre = @tipo.Valor;
                m.rutaSeguimiento = "@(Model.listaRutasFichas.Count > 0 ? (Model.listaRutasFichas.Count(p=>p.Valor == tipo.Valor && p.Valor2==1) > 0 ? Model.listaRutasFichas.FirstOrDefault(p => p.Valor == tipo.Valor && p.Valor2 == 1).Descripcion : string.Empty) : string.Empty)";
                m.rutaDetalle = "@(Model.listaRutasFichas.Count > 0 ? (Model.listaRutasFichas.Count(p => p.Valor == tipo.Valor && p.Valor2 == 2) > 0 ? Model.listaRutasFichas.FirstOrDefault(p => p.Valor == tipo.Valor && p.Valor2 == 2).Descripcion : string.Empty) : string.Empty)";
                tiposProgramas.push(m);
                </text>
            }
        }
        var anosFichas = [];
        @if (Model.listaAnosFichas.Count > 0){
            //int acceso = 0;
            foreach (var item in Model.listaAnosFichas)
            {
                <text>anosFichas.push(@item.Valor);</text>
            }
        }
        var permisoInfoEval = "@Model.permisoInfoEval";
    </script>
    @Scripts.Render("~/bundles/HomeProgramasGores")
}